<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

		<!--PROJECT ISSUE FORM -->
        <record id="project_issue_form_view_dreis" model="ir.ui.view">
            <field name="name">project_issue_form_view_dreis</field>
            <field name="model">project.issue</field>
            <field name="inherit_id" ref="project_issue.project_issue_form_view"/>
            <field name="arch" type="xml">
				<!--Info: Original order is -
					name, project_id, categ_id
					user_id, assigned_to, group\type_id
				-->

				<!--remove fields -->
				<field position="replace" name="name"/>
				<field position="replace" name="user_id"/>
				<field position="replace" name="version_id"/>
                <field position="replace" name="create_date"/>

				<!-- Project: reformated; Changing issue's project activates actions  -->
				<!-- Section_id: adds Service Team -->
				<field name="project_id" position="replace">
					<field name="section_id" string="Service Team" required="1" widget="selection"/>
					<field name="user_id" string="Responsible" domain="[('context_section_id', '=', section_id)]"/>
					<field name="ref"/>
                    <field name="project_id" required="True" colspan="4" on_change="on_change_project(project_id)"/>
                </field>
				<!-- Category -->
				<field name="categ_id" position="replace">
					<field name="functional_block_id" colspan="4" select="1" required="1" widget="selection"/>
					<field name="create_uid" readonly="1"/>
					<field name="categ_id" domain="[('allow_issues', '=', True)]" colspan="4" required="1" widget="selection"/><!-- domain=...('section_id','=',3), -->
                    <field name="create_date"/>
					<field name="name" colspan="4"/>
					<field name="date_deadline"/>
				</field>

				<!-- Stage (type_id) group-->
                 <xpath expr="/form/group/group[1]" position="replace">
                            <field name="type_id" string="Resolution Stage" widget="selection" domain="[('use_group', '=', 'resolution')]" colspan="3" groups="base.group_extended"/>
							<group colspan="1" col="2">
                            <button name="prev_type" string="Previous" type="object" icon="gtk-go-back" help="Change to Previous Stage" groups="base.group_extended"/>
                            <button name="next_type" string="Next" type="object" icon="gtk-go-forward" help="Change to Next Stage" groups="base.group_extended"/>
							</group>
                        <!--field name="regarding"/-->
                 </xpath>

                 <!-- Partner Address: add domain -->
                 <field name="partner_id" position="replace">
                        <field name="partner_id"  on_change="onchange_partner_id(partner_id, email_from, project_id)" required="1"/>
                 </field>
                 <field name="partner_address_id" position="attributes">
                        <attribute name="domain">[('partner_id','=',partner_id)]</attribute>
						<attribute name="required">1</attribute>
                 </field>
				<!--Version -->
				<field position="after" name="priority">
					<field name="version_id" groups="base.group_extended"/>
				</field>
				<!-- Create task Button -->
                 <xpath expr='//button[@name="convert_issue_task"]' position="replace">
                        <button name="convert_issue_task" string="Create Task" icon="gtk-index" type="object" attrs="{'invisible':['|',('task_id','!=',False), ('state','in',['cancel','done'])]}"/>
                 </xpath>
				<field position="replace" name="progress">
					<field name="assigned_to" readonly="1" attrs="{'invisible':[('task_id','=',False)]}"/>
                    <field name="progress" nolabel="1" widget="progressbar" attrs="{'invisible':[('task_id','=',False)]}"/>
				</field>
				
                <!-- STATES -->
                    <button name="case_open" position="replace">
                            <button name="case_open" string="Open" states="draft,pending" type="object" icon="gtk-media-play" help="Moves to state In Progress"/>
                    </button>
                    <button name="case_close" position="replace">
                            <button name="case_close" string="Done" states="open,pending" type="object" icon="terp-dialog-close"/>
                    </button>
                    
                 <xpath expr='//page[@string="Communication &amp; History"]' position="attributes">
                   <attribute name="groups">project_service_base.group_project_viewer</attribute>
                 </xpath>

                 <!-- ###BUG https://bugs.launchpad.net/openobject-addons/+bug/944879 -->
                 <field name="email_cc" position="attributes">
                   <attribute name="widget">email</attribute>
                 </field>

				 <!-- Task History tab-->
                 <xpath expr='//page[@string="Extra Info"]' position="before">
                    <page string="Tasks">
                        <field name="tasks" nolabel="1" readonly="1"/>
                    </page>
                 </xpath>

            </field>
		</record>

		<!--PROJECT ISSUE SEARCH -->
        <record id="view_project_issue_filter_dreis" model="ir.ui.view">
            <field name="name">Project Issue Tracker Search</field>
            <field name="model">project.issue</field>
            <field name="inherit_id" ref="project_issue.view_project_issue_filter"/>
            <field name="arch" type="xml">

                   <!-- "To-Do" button relabeled to "In Progress" -->
                   <filter name="todo" position="attributes">
                           <attribute name="string">In Progress</attribute>
                   </filter>
                   <!-- Add buttons "Edit" (extended only) and "Deadlines" -->
                   <field name="name" position="before">
					      <filter name="edit" string="Edit" context="{'set_editable':True,'seq_visible': True}" icon="gtk-execute" groups="base.group_extended"/>
					      <separator orientation="vertical"/>
					      <filter string="Deadlines" context="{'deadline_visible': False}" domain="[('date_deadline','&lt;&gt;',False)]" help="Show only issues having a deadline" icon="terp-gnome-cpu-frequency-applet+" />
					      <separator orientation="vertical"/>
                    </field>
                    <!--  name filter -->
                    <field name="name" position="replace">
                        <field name="name" string="Issue" colspan="2"
                               filter_domain="['|','|','|','|', ('ref','ilike',self), ('project_id','ilike',self), ('partner_id','ilike',self), ('email_from','ilike',self), ('name','ilike',self)]"
                        />
                    </field>
                    <!--  user_id buttons with same order as Tasks  (BUGFIX to report) -->
                    <field name="user_id" position="replace">
                        <field name="user_id" filter_domain="['|',('user_id','=',self),('create_uid','=',self)]" string="User">
                            <filter domain="['|',('user_id','=',uid),('create_uid','=',uid)]"  help="My Issues" icon="terp-personal" />
                            <filter domain="[('user_id','=',False)]" help="Unassigned Issues" icon="terp-personal-" groups="project.group_project_manager"/>
                        </field>
                    </field>
                    <field name="project_id" position="replace"/>

                    <!-- Search by "ref" instead of "id"; add section_id (Team) and department_id -->
                    <field name="id" position="replace">
						<field name="section_id" string="Team" widget="selection" groups="base.group_extended"/>
						<field name="department_id" widget="selection" operator="child_of"/>
				    </field>
                    <!--  GROUP BY -->
                    <filter string="Partner" position="after">
                        <filter string="Department" icon="terp-partner" domain="[]" context="{'group_by':'department_id'}"/>
                        <filter string="Team" icon="STOCK_SELECT_COLOR" domain="[]" context="{'group_by':'section_id'}"/>
                    </filter>
			</field>
		</record>

		<!--PROJECT ISSUE TREE -->
        <record model="ir.ui.view" id="project_issue_tree_view_reis">
            <field name="name">Project Issue Tracker Tree</field>
            <field name="model">project.issue</field>
            <field name="inherit_id" ref="project_issue.project_issue_tree_view"/>
            <field name="arch" type="xml">
              <data>
                <!-- Colors like Task Tree -->
                <!-- TODO: red for surpassed dealines  -->
                <tree position="attributes">
                      <attribute name="colors">grey:state in ('cancel','done');blue:state == 'pending'</attribute>
                </tree>
                <!-- Internal ID, Version and Stage visible only in Extended mode -->
                <field name="id" position="attributes"><attribute name="groups">base.group_extended</attribute></field>
                <field name="type_id" position="attributes"><attribute name="groups">base.group_extended</attribute></field>
                <button name="prev_type" position="attributes"><attribute name="groups">base.group_extended</attribute></button>
                <button name="next_type" position="attributes"><attribute name="groups">base.group_extended</attribute></button>
                <field name="version_id" position="attributes"><attribute name="groups">base.group_extended</attribute></field>
                <field name="categ_id" position="attributes"><attribute name="groups">base.group_extended</attribute></field>
                <!-- Ref and Category visible after issue name; add Department after responsible -->
                <field name="create_date" position="before">
                    <field name="ref"/>
				</field>
                <field name="user_id" position="after">
					<field name="department_id" groups="base.group_extended"/>
					<field name="section_id" groups="base.group_extended"/>
					<field name="create_uid"/>
				</field>
				<!-- State buttons equal to Task Tree -->
				<!-- TODO: create a workflow process -->
                    <button name="case_cancel" position="replace"/>
                    <button name="case_close" position="replace"/>
                    <button name="case_pending" position="replace"/>
                    <button name="case_escalate" position="replace"/>
                    <button name="case_reset" position="replace"/>
                    <button name="case_open" position="replace">
                            <button name="convert_issue_task_tree" string="Create Task" icon="gtk-index" type="object" attrs="{'invisible':['|',('task_id','!=',False), ('state','in',['cancel','done'])]}"/>
                            <button name="case_open" string="Open" states="draft,pending" type="object" icon="gtk-media-play" help="Moves to state In Progress" groups="base.group_extended"/>
                            <button name="case_close" string="Done" states="open,pending" type="object" icon="terp-dialog-close"/>
                    </button>

              </data>
            </field>
        </record>

    <!-- PROJECT ISSUE MENU ACTION: [-]no default pressed buttons and user; [+] default department -->
    <record model="ir.actions.act_window" id="project_issue.project_issue_categ_act0">
        <field name="name">Issues</field>
        <field name="res_model">project.issue</field>
        <field name="view_type">form</field>
        <field name="view_mode">kanban,tree,calendar</field>
        <field name="view_id" eval="False"/>
        <field name="domain" eval=""/>
        <field name="context">{"search_default_project_id":project_id, "search_default_department_id":department_id}</field>
        <field name="search_view_id" ref="project_issue.view_project_issue_filter"/>
        <field name="help">Issues such as system bugs, customer complaints, and material breakdowns are collected here. You can define the stages assigned when solving the project issue (analysis, development, done). With the mailgateway module, issues can be integrated through an email address (example: support@mycompany.com)</field>
    </record>

	<!-- ISSUE KANBAN VIEW: moving from firest to last position-->
    <record model="ir.actions.act_window.view" id="project_issue.action_crm_tag_kanban_view0">
        <field name="sequence" eval="10"/>
    </record>

    # ------------------------------------------------------
    # Menu Items missing (copied from project_longterm)
    # ------------------------------------------------------
        <menuitem id="menu_pm_resources_project1"
            groups="base.group_extended"
            name="Resources" parent="project.menu_definitions" sequence="3"/>
        <menuitem action="resource.action_resource_resource_tree" id="menu_view_resource" parent="menu_pm_resources_project1" sequence="2"/>
        <menuitem action="resource.action_resource_calendar_form" id="menu_view_resource_calendar" parent="menu_pm_resources_project1" sequence="1"/>
        <menuitem action="resource.action_resource_calendar_leave_tree" id="menu_view_resource_calendar_leaves" parent="menu_pm_resources_project1" sequence="1"/>

    </data>
</openerp>



















